# Hixtrip FE Online

## 前端高级/架构师需求

请移步至[v1 分支](https://github.com/hixtrip/fe-online/tree/v1)

## 准备

- fork 此仓库
- 根据如下要求实现相关代码
- 完成要求
  - 提交`pull request`
  - 提供页面截图

## 需求

> 当前已有初始化的`monorepo`仓库, 已经包含`backend/auth-service`, `apps/auth-app`, `apps/manage-app`项目。

- `backend/auth-service`项目已包含登陆接口、获取用户信息接口
  - 如何设计`BFF`层架构, 统一这两个接口，使得前端只需要调用一次登陆，返回登陆成功的`token`以及`用户信息`
- `auth-app` 采用`React`实现，`manage-app` 采用`Vue`实现
  - 需要使用`auth-app` 调用第一步实现的接口，并存储相关的`token`信息
  - `manage-app` 采用微前端方案内嵌 `auth-app`的功能
要求点：
- `BFF` 需要考虑微服务架构，对原有业务非侵入式
- `微前端` 设计不仅仅是需要采用`qiankun`， 而是如何设计一套微前端的数据通讯方案
> 其他加分点：如何设计`git flow`规范, 设计`vue`, `react`, `backend`开发规范 etc. 或者请写出关于前端架构的思考，想法。

## GIT工作流

- master分支不修改，依然单独分支对应正式环境。
- develop分支对应测试环境，也可以将develop作为文件夹，以`/`分割符切分分支，对应规则就是分支名前缀带有develop标识即对应测试环境。
- hotfix、release下分支对应预生产环境，规则同上。
- 对应分支上代码最新提交，即触发代码打包部署到对应环境。同时不会影响对应环境下的其他分支代码。

> 对应分支或者前缀命名可根据个人习惯定义，分支名对应到CI脚本上处理即可。

### 提交或提审 commitmsg

```
<type, 必填>(<scope，可省略，尽量明确且统一中文>): <subject，必填>
// 空一行
<body，可省略>
```

type 类型`.commitlintrc.js`配置中约定规范。

- 版本号自动更新，根据当前版本是否有feat提交来确定是否更新中间版本号，否则有fix则更新最后版本号。
- changelog日志里计入feat、fix、perf提交日志，所以在提交git时需要明确填写，提交人员需要自行明确本次记录是否需要计入日志。
- feat为版本迭代需求，仅需提交一次作为版本合并消息，对feat补充调整使用wip。
- fix为产品明确的线上版本修复需求，而非提测的BUG修复，提测修复也使用wip。

#### 命名

- 类、接口、枚举使用 PascalCase。
- 函数、属性、本地变量使用 camelCase。
- 全局变量为全大写加下划线，函数内不得有魔法值。
- 非 css、html 尽量不加中杠和下划线。
- 尽可能使用完整的单词拼写命名。
- 文件夹下的内容，文件或文件夹功能、定义、业务逻辑相似重复，使用复数命名。
- 二级文件夹下的文件功能单一，以简略的单数命名，并建立 index.ts 统一导出。

#### 类型

- 除非类型/函数需要在多个组件中共享，否则不要导出(export)。
- 在文件中，类型定义应该放在最前面。
- 导入(import)的函数需要按字母排序。
- 必须在 setup 里使用的函数，使用 use 前缀。

vue 文件模块规范:

```
<script>...</script>

<template>...</template>

<style>...</style>
```

#### 注释

- 为函数、接口、枚举和类使用`/** */`文档注释，功能简单时可以简略为一行，有参数值、有返回值时需要`@param`、`@return`。
- 函数内部使用`//单行注释`、`/* */`多行注释，尽量简练重点。
- 待完善、改进等注释使用`// TODO 注释`。

#### 函数

- 匿名函数使用箭头函数。
- if 超过 2 个 boolean 判断语句需要单独抽出为变量。

# 单元测试

## 什么是单元测试

单元测试，Unit Testing，简称 UT，是指对软件中的最小可测试单元进行检查和验证，前端开发中单元可以是一个 function 也可以是一个 class，也可以是一个组件。

## 为什么要做单元测试

- **必要性**：JavaScript 缺少类型检查，编译期间无法定位到错误，单元测试可以测试多种异常情况。
- **正确性**：测试可以验证代码的正确性，在上线前做到心里有底。
- **自动化**：通过编写测试用例，可以做到一次编写，多次运行。
- **保证重构**：项目产品迭代后必然存在代码重构的过程，有测试用例做后盾，就可以大胆的进行重构。

## 单元测试的结果评判依据

如何判断一个单元测试编写是否合格？看测试覆盖率。

覆盖率是单元测试核心指标，又细分为`语句覆盖率(Statements)`、`分支覆盖率(Branches)`、`函数覆盖率(Functions)`、`行覆盖率(Lines)`。

合格的测试用例不仅要包含正常情况输入输出，也要包含异常情况输入输出的判断，不能以开发的思维去编写测试用例。



### 自己的想法
我曾经有幸和一位优秀的前端架构师成为同事，做过几个项目，从他搭建的项目学到不少架构相关的东西，自己也或多或少得到一些锻炼。对于前端架构，我觉得已经不是简单的完成一个项目就行了，而是从项目立项到项目交付或上线的每一步都有一定的规范和约束，同时在开发中需要用到设计模式，根据场景和需求，在不同的解决方案中选出一个最佳的且优雅的方案。微前端的数据通讯方案我觉得可以通过 iframe 引入展示内容，并提供封装 postMessage 的通讯桥接中间件为内容提供服务，根据平台业务区分类型，AB两端约定好对应的事件类型，在一端设置一个接收监听器，监听对应的事件类型，然后触发对应事件。同样，再设置一个发送监听器，传入对应的事件类型和事件携带的数据，在中间加个事件类型的判断，如果在约定好的事件类型中则继续发送，否则停止发送。当然这只是针对事件类型进行监听，还以约定一些时机来触发钩子函数，针对不同的钩子类型调用不同的钩子函数，就像vue的生命周期一样，当iframe页面到了某个阶段，主界面能接收到iframe的状态。